'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _interopRequireDefault = function (obj) { return obj && obj.__esModule ? obj : { 'default': obj }; };

/**
 * This function reads a js file and transforms it into AST
 *
 * @author Mohamad Mohebifar
 * @param file
 * @param options
 * @returns {Object}
 */
exports.readFile = readFile;

/**
 * This function reads a js string and transforms it into AST
 *
 * @author Mohamad Mohebifar
 * @param js
 * @param options
 * @returns {Object}
 */
exports.read = read;

var _acorn = require('acorn');

var _acorn2 = _interopRequireDefault(_acorn);

var _escodegen = require('escodegen');

var _escodegen2 = _interopRequireDefault(_escodegen);

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _coffee = require('coffee-script');

var _coffee2 = _interopRequireDefault(_coffee);

function readFile(file, options) {
  var _this = this;

  if (typeof options.coffee === 'undefined') {
    options.coffee = /\.coffee$/.test(file);
  }

  if (options.sync) {
    var js = _fs2['default'].readFileSync(file);
    return this.read(js, options);
  } else {
    _fs2['default'].readFile(file, function (js) {
      if (options.callback) {
        options.callback(_this.read(js, options));
      }
    });
  }
}

function read(js, options) {
  var comments = [];
  var tokens = [];

  options.ranges = true;
  options.onComment = comments;
  options.onToken = tokens;

  if (options.coffee) {
    js = _coffee2['default'].compile(js);
  }

  var ast = _acorn2['default'].parse(js, options);

  _escodegen2['default'].attachComments(ast, comments, tokens);

  return ast;
}

exports['default'] = {
  read: read,
  readFile: readFile
};